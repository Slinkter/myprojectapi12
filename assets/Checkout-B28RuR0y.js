import{r as y,u as x,j as e,a as s}from"./index-BjDJNJU4.js";const v=a=>a.startsWith("4")?"visa":a.startsWith("5")?"mastercard":"",f=a=>{const{number:r,name:n,expiry:o,cvc:m}=a,t={},i=r.replace(/\s/g,"");let u=0,p=!1;for(let d=i.length-1;d>=0;d--){let c=parseInt(i.charAt(d));p&&(c*=2)>9&&(c-=9),u+=c,p=!p}if(i.length>0&&u%10!==0?t.number="Invalid card number":i.length===0&&(t.number="Card number is required"),n||(t.name="Name is required"),!o)t.expiry="Expiry date is required";else{const[d,c]=o.split("/");if(!d||!c||d.length!==2||c.length!==2)t.expiry="Invalid date format (MM/YY)";else{const l=new Date(`20${c}`,d-1),h=new Date;l.setHours(23,59,59,999),h.setHours(0,0,0,0),l<h&&(t.expiry="Card has expired")}}return m?m.length<3&&(t.cvc="CVC must be at least 3 digits"):t.cvc="CVC is required",t},g={paymentMethod:"visa",cardInfo:{number:"",name:"",expiry:"",cvc:""},errors:{},cardType:""};function b(a,r){switch(r.type){case"SET_FIELD_VALUE":return{...a,cardInfo:{...a.cardInfo,[r.payload.name]:r.payload.value}};case"SET_PAYMENT_METHOD":return{...a,paymentMethod:r.payload};case"SET_ERRORS":return{...a,errors:r.payload};case"SET_CARD_TYPE":return{...a,cardType:r.payload};default:return a}}const C=()=>{const[a,r]=y.useReducer(b,g),{paymentMethod:n,cardInfo:o,errors:m,cardType:t}=a,i=x();return y.useEffect(()=>{if(n==="bitcoin")r({type:"SET_ERRORS",payload:{}});else{const l=f(o);r({type:"SET_ERRORS",payload:l})}const c=v(o.number);c!==t&&r({type:"SET_CARD_TYPE",payload:c})},[n,o,t]),{paymentMethod:n,cardInfo:o,errors:m,cardType:t,handlePayment:()=>{if(n==="bitcoin"){i("/checkout-success");return}const c=f(o);r({type:"SET_ERRORS",payload:c}),Object.keys(c).length===0&&i("/checkout-success")},handleCardInfoChange:c=>{let{name:l,value:h}=c.target;l==="number"&&(h=h.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim()),l==="expiry"&&(h=h.replace(/\D/g,"").replace(/(.{2})/,"$1/").trim()),r({type:"SET_FIELD_VALUE",payload:{name:l,value:h}})},setPaymentMethod:c=>{r({type:"SET_PAYMENT_METHOD",payload:c})}}},_=()=>{const{paymentMethod:a,cardInfo:r,errors:n,cardType:o,handlePayment:m,handleCardInfoChange:t,setPaymentMethod:i}=C(),u=a!=="bitcoin"&&Object.keys(n).length>0;return e.jsx("div",{className:"checkout-page",children:e.jsxs(s.Card,{className:"checkout-card",children:[e.jsx(s.Typography,{variant:"h4",color:"blue-gray",className:"checkout-card__title",children:"Choose a payment method"}),e.jsxs("div",{className:"checkout-card__payment-methods",children:[e.jsx(s.Radio,{id:"visa",name:"paymentMethod",label:"Visa",checked:a==="visa",onChange:()=>i("visa")}),e.jsx(s.Radio,{id:"mastercard",name:"paymentMethod",label:"Mastercard",checked:a==="mastercard",onChange:()=>i("mastercard")}),e.jsx(s.Radio,{id:"bitcoin",name:"paymentMethod",label:"Bitcoin",checked:a==="bitcoin",onChange:()=>i("bitcoin")})]}),(a==="visa"||a==="mastercard")&&e.jsxs("div",{className:"checkout-card__form",children:[e.jsxs("div",{children:[e.jsx(s.Input,{label:"Card Number",name:"number",value:r.number,onChange:t,maxLength:19,error:!!n.number,icon:o==="visa"?e.jsx("i",{className:"fab fa-cc-visa"}):o==="mastercard"?e.jsx("i",{className:"fab fa-cc-mastercard"}):null}),n.number&&e.jsx(s.Typography,{color:"red",variant:"small",children:n.number})]}),e.jsxs("div",{children:[e.jsx(s.Input,{label:"Cardholder Name",name:"name",value:r.name,onChange:t,error:!!n.name}),n.name&&e.jsx(s.Typography,{color:"red",variant:"small",children:n.name})]}),e.jsxs("div",{className:"checkout-card__form-row",children:[e.jsxs("div",{className:"checkout-card__form-col--half",children:[e.jsx(s.Input,{label:"Expiry (MM/YY)",name:"expiry",value:r.expiry,onChange:t,maxLength:5,error:!!n.expiry}),n.expiry&&e.jsx(s.Typography,{color:"red",variant:"small",children:n.expiry})]}),e.jsxs("div",{className:"checkout-card__form-col--half",children:[e.jsx(s.Input,{label:"CVC",name:"cvc",value:r.cvc,onChange:t,maxLength:4,error:!!n.cvc}),n.cvc&&e.jsx(s.Typography,{color:"red",variant:"small",children:n.cvc})]})]})]}),e.jsx(s.Button,{onClick:m,variant:"gradient",color:"green",className:"checkout-card__pay-button",disabled:u,children:"Pay Now"})]})})};export{_ as default};
